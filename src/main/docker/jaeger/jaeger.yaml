receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317

processors:
  batch:
  adaptive_sampling:
    # Adaptive sampling expects remote_sampling extension with `adaptive:` config enabled
  tail_sampling:
    decision_wait: 10s
    num_traces: 1000
    policies:
      #      - name: latency-policy
      #        type: latency
      #        latency:
      #          threshold_ms: 500
      #      - name: error-policy
      #        type: status_code
      #        status_code:
      #          status_codes: [ ERROR, UNSET ]
      - name: filter-uri-policy
        type: string_attribute
        string_attribute:
          key: uri
          values: [ \/health, \/metrics, \/openapi, \/q/.+ ]
          enabled_regex_matching: true
          invert_match: true
      - name: filter-target-policy
        type: string_attribute
        string_attribute:
          key: http.target
          values: [ \/health, \/metrics, \/openapi, \/q/.+ ]
          enabled_regex_matching: true
          invert_match: true

exporters:
  jaeger_storage_exporter:
    trace_storage: trace_store
#  debug:
#    verbosity: detailed

service:
  extensions: [ jaeger_storage, jaeger_query, remote_sampling, healthcheckv2 ]
  pipelines:
    traces:
      receivers: [ otlp ]
      processors: [ tail_sampling, batch ]
      exporters: [ jaeger_storage_exporter ]
  telemetry:
    resource:
      service.name: jaeger
    metrics:
      level: detailed
      readers:
        - pull:
            exporter:
              prometheus:
                host: 0.0.0.0
                port: 8889
    logs:
      level: debug
    # TODO Initialize telemetry tracer once OTEL released new feature.
    # https://github.com/open-telemetry/opentelemetry-collector/issues/10663

extensions:
  healthcheckv2:
    use_v2: true
    http:

  jaeger_query:
    storage:
      traces: trace_store
      traces_archive: archive_store
    ui:
      config_file: /jaeger/config-ui.json
    # The maximum duration that is considered for clock skew adjustments.
    # Defaults to 0 seconds, which means it's disabled.
    max_clock_skew_adjust: 0s

  jaeger_storage:
    backends:
      trace_store:
        memory:
          max_traces: 100000
      archive_store:
        memory:
          max_traces: 100000

  remote_sampling:
    # You can either use file or adaptive sampling strategy in remote_sampling
    # file:
    #   path: /jaeger/sampling-strategies.json
    adaptive:
      sampling_store: trace_store
      initial_sampling_probability: 0.1
    http:
    grpc:
